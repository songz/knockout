// Generated by CoffeeScript 1.6.1
(function() {
  var goToRoom, myRootRef, roomTemplate, verticalCenter;

  $("#searchRoom").focus();

  goToRoom = function() {
    var roomName;
    roomName = $("#roomName").val().trim();
    if (roomName.length <= 0) {
      alert("Room Name is Invalid");
      return;
    }
    $("#roomContainer").fadeOut('slow');
    return window.location = "/" + roomName;
  };

  $('#submitRoomButton').click(function() {
    var roomDescription, roomId, roomName;
    roomName = $("#roomName").val();
    roomDescription = $("#roomDescription").val();
    if (roomName.length < 3 || roomDescription.length < 3 || roomName.length > 100 || roomDescription.length > 200) {
      alert("Invalid Room Name or Room Description. Max number of characters for room name is 100 characters, for room description is 200 characters");
      return;
    }
    roomId = "" + (Date.now() % 10000000) + (Math.floor(Math.random() * 10000));
    return myRootRef.child(roomId).setWithPriority({
      name: roomName,
      description: roomDescription
    }, -Date.now(), function() {
      return window.location = "/" + roomId;
    });
  });

  $('#searchRoom').keyup(function(e) {
    if ($(this).val().length > 0) {
      $(".roomInformation").hide();
      $(".roomInformation[data-info*=" + ($(this).val()) + "]").show();
      return;
    }
    return $(".roomInformation").show();
  });

  verticalCenter = function() {
    var mtop;
    mtop = (window.innerHeight - $("#insideContainer").outerHeight()) / 2;
    return $("#insideContainer").css({
      "margin-top": "" + mtop + "px"
    });
  };

  roomTemplate = Handlebars.compile($("#roomTemplate").html());

  myRootRef = new Firebase('https://nodeknockout.firebaseIO.com/');

  myRootRef.once('value', function(dataSnapshot) {
    var k, v, _ref, _results;
    _ref = dataSnapshot.val();
    _results = [];
    for (k in _ref) {
      v = _ref[k];
      v.url = "/" + k;
      v.usersCount = v.users ? Object.keys(v.users).length : 0;
      _results.push($("#roomsContainer").append(roomTemplate(v)));
    }
    return _results;
  });

}).call(this);
