// Generated by CoffeeScript 1.6.1
(function() {
  var myRootRef, roomTemplate, verticalCenter;

  verticalCenter = function() {
    var mtop;
    mtop = (window.innerHeight - $("#roomContainer").outerHeight()) / 2;
    mtop = mtop < 40 ? 50 : mtop;
    $("#roomContainer").css({
      "margin-top": "" + mtop + "px"
    });
    return window.onresize = verticalCenter;
  };

  verticalCenter();

  $("#searchRoom").focus();

  $('#submitRoomButton').click(function() {
    var roomDescription, roomId, roomName;
    roomName = $("#roomName").val();
    roomDescription = $("#roomDescription").val();
    if (roomName.length < 3 || roomDescription.length < 3 || roomName.length > 100 || roomDescription.length > 200) {
      alert("Invalid Room Name or Room Description. Max number of characters for room name is 100 characters, for room description is 200 characters");
      return;
    }
    roomId = "" + (Date.now() % 10000000) + (Math.floor(Math.random() * 10000));
    return myRootRef.child(roomId).setWithPriority({
      name: roomName,
      description: roomDescription
    }, -Date.now(), function() {
      return window.location = "/" + roomId;
    });
  });

  $('#searchRoom').keyup(function(e) {
    if ($(this).val().length > 0) {
      $(".roomInformation").hide();
      $(".roomInformation[data-info*=" + ($(this).val()) + "]").show();
      return;
    }
    return $(".roomInformation").show();
  });

  roomTemplate = Handlebars.compile($("#roomTemplate").html());

  myRootRef = new Firebase('https://nodeknockout.firebaseIO.com/');

  myRootRef.once('value', function(dataSnapshot) {
    return dataSnapshot.forEach(function(childSnapshot) {
      var v;
      v = childSnapshot.val();
      v.url = "/" + (childSnapshot.name());
      v.usersCount = v.users ? Object.keys(v.users).length : 0;
      $("#roomsContainer").append(roomTemplate(v));
      verticalCenter();
    });
  });

}).call(this);
