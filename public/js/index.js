// Generated by CoffeeScript 1.6.1
(function() {
  var generateRoom, myRootRef, roomTemplate;

  $("#searchRoom").focus();

  $('#submitRoomButton').click(function() {
    var roomDescription, roomId, roomName;
    roomName = $("#roomName").val();
    roomDescription = $("#roomDescription").val();
    if (roomName.length < 3 || roomDescription.length < 3 || roomName.length > 100 || roomDescription.length > 200) {
      alert("Invalid Room Name or Room Description. Max number of characters for room name is 100 characters, for room description is 200 characters");
      return;
    }
    roomId = "" + (Date.now() % 10000000) + (Math.floor(Math.random() * 10000));
    return myRootRef.child(roomId).setWithPriority({
      name: roomName,
      description: roomDescription
    }, -Date.now(), function() {
      return window.location = "/" + roomId;
    });
  });

  $('#searchRoom').keyup(function(e) {
    var val;
    val = $(this).val().toLowerCase();
    if (val.length > 0) {
      $(".roomInformation").hide();
      $(".roomInformation[data-info*='" + val + "']").show();
      return;
    }
    return $(".roomInformation").show();
  });

  roomTemplate = Handlebars.compile($("#roomTemplate").html());

  generateRoom = function(childSnapshot) {
    var v;
    v = childSnapshot.val();
    v.url = "/" + (childSnapshot.name());
    v.key = childSnapshot.name();
    v.usersCount = v.users ? Object.keys(v.users).length : 0;
    return $("#roomsContainer").append(roomTemplate(v));
  };

  myRootRef = new Firebase('https://nodeknockout.firebaseIO.com/');

  myRootRef.on('child_added', function(dataSnapshot) {
    return generateRoom(dataSnapshot);
  });

  myRootRef.on('child_removed', function(dataSnapshot) {
    return $("#" + (dataSnapshot.name())).remove();
  });

  Handlebars.registerHelper("lower", function(options) {
    return options.fn(this).toLowerCase();
  });

  $('#myModal').on('shown.bs.modal', function(e) {
    console.log("modal appears");
    return $("#roomName").focus();
  });

}).call(this);
