// Generated by CoffeeScript 1.6.1
(function() {
  var goToRoom, myRootRef, roomTemplate, verticalCenter;

  $("#roomName").focus();

  goToRoom = function() {
    var roomName;
    roomName = $("#roomName").val().trim();
    if (roomName.length <= 0) {
      alert("Room Name is Invalid");
      return;
    }
    $("#roomContainer").fadeOut('slow');
    return window.location = "/" + roomName;
  };

  $('#submitRoomButton').click(function() {
    var roomDescription, roomId, roomName;
    roomName = $("#roomName").val();
    roomDescription = $("#roomDescription").val();
    roomId = "" + (Date.now() % 10000000) + (Math.floor(Math.random() * 10000));
    return myRootRef.child(roomId).set({
      name: roomName,
      description: roomDescription
    }, function() {
      return window.location = "/" + roomId;
    });
  });

  $('#roomName').keypress(function(e) {
    if (e.keyCode === 13) {
      return goToRoom();
    }
  });

  verticalCenter = function() {
    var mtop;
    mtop = (window.innerHeight - $("#insideContainer").outerHeight()) / 2;
    return $("#insideContainer").css({
      "margin-top": "" + mtop + "px"
    });
  };

  roomTemplate = Handlebars.compile($("#roomTemplate").html());

  myRootRef = new Firebase('https://nodeknockout.firebaseIO.com/');

  myRootRef.once('value', function(dataSnapshot) {
    var k, v, _ref, _results;
    _ref = dataSnapshot.val();
    _results = [];
    for (k in _ref) {
      v = _ref[k];
      v.url = "/" + k;
      v.usersCount = v.users ? Object.keys(v.users).length : 0;
      _results.push($("#roomsContainer").append(roomTemplate(v)));
    }
    return _results;
  });

}).call(this);
